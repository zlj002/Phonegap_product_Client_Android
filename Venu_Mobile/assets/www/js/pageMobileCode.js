var timer=60;var pMobileCode={initialize:function(){this.bindEvents();this.bindResendMessage()},bindData:function(){},bindResendMessage:function(){window.setTimeout(function(){timer--;if(timer>0){$("#btnResendMessage").text("重发("+timer+"S)");pMobileCode.bindResendMessage()}else{$("#btnResendMessage").text("重发");$("#btnResendMessage").unbind().on("tap",function(){var e=$("#txtMobileNum").val();var n=serverHost+"/MobileService/UserService/UserService.asmx/RegisterMobile";$.ui.showMask("请稍等……");var t={schoolID:pmain.getSchoolInfo().ID,mobileNumber:e};$.ajax({type:"Post",contentType:"application/json; charset=utf-8",url:n,data:MY_JSON.stringify(t),dataType:"json",success:function(e){var n=MY_JSON.parse(e.d);if(n.ReturnFlag==1){$("#btnResendMessage").unbind();timer=60;pMobileCode.bindResendMessage()}else{$.ui.popup({title:"提示",message:n.ReturnMessage,cancelText:"确定",cancelCallback:function(){},cancelOnly:true})}$.ui.hideMask()},error:function(e,n,t){$.ui.hideMask();$.ui.popup({title:"提示",message:"短验证码发送失败，请稍后再试",cancelText:"确定",cancelCallback:function(){},cancelOnly:true})}})})}},1e3)},bindEvents:function(){$("#btnToSetPassword").unbind().on("tap",function(){var e=$("#txtMobileCode").val();var n=serverHost+"/MobileService/UserService/UserService.asmx/VerifyMobileCode";$.ui.showMask("请稍等……");var t={schoolID:pmain.getSchoolInfo().ID,mobileNumber:$("#txtMobileNum").val(),messageCode:e};$.ajax({type:"Post",contentType:"application/json; charset=utf-8",url:n,data:MY_JSON.stringify(t),dataType:"json",success:function(e){var n=MY_JSON.parse(e.d);if(n.ReturnFlag==1){$.ui.loadContent("#pageSetPassword",false,false,"left")}else{$.ui.popup({title:"提示",message:n.ReturnMessage,cancelText:"确定",cancelCallback:function(){},cancelOnly:true})}$.ui.hideMask()},error:function(e,n,t){$.ui.hideMask();$.ui.popup({title:"提示",message:"服务器异常请稍后再试",cancelText:"确定",cancelCallback:function(){},cancelOnly:true})}})})}};