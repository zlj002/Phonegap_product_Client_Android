var changePhoneCodeTimer=60;var pChangePhone={initialize:function(){this.initEvents();this.bindData()},initEvents:function(){$("#txtOldPhoneMessageCode_ChangePhone").val("");$("#btnChangePhoneStep1").unbind().bind("tap",function(){var e=true;var n=$("#txtOldPhoneMessageCode_ChangePhone").val();if(n==""){$.ui.popup({title:"提示",message:"请输入验证码",cancelText:"确定",cancelCallback:function(){},cancelOnly:true});e=false}if(e){var a=serverHost+"/MobileService/UserService/UserService.asmx/ValidateChangePhoneNumberOldPhoneCode";$.ui.showMask("请稍等……");var t={schoolID:pmain.getSchoolInfo().ID,userID:localMobelInfo.getUserName(),code:n};$.ajax({type:"Post",contentType:"application/json; charset=utf-8",url:a,data:MY_JSON.stringify(t),dataType:"json",success:function(e){var n=MY_JSON.parse(e.d);if(n.ReturnFlag==1){$.ui.loadContent("#pageChangePhoneNewPhone",false,false,"left")}else{$.ui.popup({title:"提示",message:n.ReturnMessage,cancelText:"确定",cancelCallback:function(){},cancelOnly:true})}$.ui.hideMask()},error:function(e,n,a){$.ui.hideMask();$.ui.popup({title:"提示",message:"验证码验证失败",cancelText:"确定",cancelCallback:function(){},cancelOnly:true})}})}})},bindBtnSend:function(){$("#btnResendMessage_ChangePhone").unbind().on("tap",function(){var e=$("#txtOldPhoneNum").val();var n=serverHost+"/MobileService/UserService/UserService.asmx/GenReBindMobileOldMobileCode";$.ui.showMask("请稍等……");var a={schoolID:pmain.getSchoolInfo().ID,mobileNumber:e};$.ajax({type:"Post",contentType:"application/json; charset=utf-8",url:n,data:MY_JSON.stringify(a),dataType:"json",success:function(e){var n=MY_JSON.parse(e.d);if(n.ReturnFlag==1){$("#btnResendMessage_ChangePhone").unbind();changePhoneCodeTimer=60;pChangePhone.bindResendMessage()}else{$.ui.popup({title:"提示",message:n.ReturnMessage,cancelText:"确定",cancelCallback:function(){},cancelOnly:true})}$.ui.hideMask()},error:function(e,n,a){$.ui.hideMask();$.ui.popup({title:"提示",message:"短验证码发送失败，请稍后再试",cancelText:"确定",cancelCallback:function(){},cancelOnly:true})}})})},bindResendMessage:function(){window.setTimeout(function(){changePhoneCodeTimer--;if(changePhoneCodeTimer>0){$("#btnResendMessage_ChangePhone").text("重发("+changePhoneCodeTimer+"S)");pChangePhone.bindResendMessage()}else{$("#btnResendMessage_ChangePhone").text("重发");pChangePhone.bindBtnSend()}},1e3)},bindData:function(){if(serverHost!=""){var e=serverHost+"/MobileService/UserService/UserService.asmx/GetUserInfoByUserID";$.ui.showMask("正在加载……");var n={userID:localMobelInfo.getUserName()};$.ajax({type:"Post",contentType:"application/json; charset=utf-8",url:e,data:MY_JSON.stringify(n),dataType:"json",success:function(e){var n=MY_JSON.parse(e.d);if(n.ReturnFlag=="1"){$("#txtOldPhoneNum").val(n.Entity.MobileNumber);pChangePhone.bindBtnSend();$.ui.hideMask()}else{$.ui.hideMask()}},error:function(e){$.ui.hideMask();$.ui.popup({title:"提示",message:"获个人安全信息出错",cancelText:"确定",cancelCallback:function(){},cancelOnly:true})}})}}};